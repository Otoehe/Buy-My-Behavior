<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ –¢–µ—Å—Ç —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó showNotification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
        }
        
        .section h3 {
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        
        .status-item.error {
            border-left-color: #f44336;
        }
        
        .status-item.warning {
            border-left-color: #ff9800;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover:before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .btn-info { background: linear-gradient(45deg, #2196F3, #1976D2); }
        .btn-warning { background: linear-gradient(45deg, #ff9800, #f57c00); }
        .btn-danger { background: linear-gradient(45deg, #f44336, #d32f2f); }
        .btn-success { background: linear-gradient(45deg, #4CAF50, #388e3c); }
        .btn-purple { background: linear-gradient(45deg, #9c27b0, #7b1fa2); }
        .btn-cyan { background: linear-gradient(45deg, #00bcd4, #0097a7); }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px 10px;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        
        .log-entry.error {
            border-left-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .log-entry.warning {
            border-left-color: #ff9800;
            background: rgba(255, 152, 0, 0.1);
        }
        
        .feature-list {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .feature-list ul {
            list-style: none;
        }
        
        .feature-list li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .feature-list li:before {
            content: '‚úÖ';
            position: absolute;
            left: 0;
        }
        
        code {
            background: rgba(0,0,0,0.4);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #ffd700;
        }
        
        .permission-status {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .permission-granted {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }
        
        .permission-denied {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }
        
        .permission-default {
            background: rgba(255, 152, 0, 0.3);
            border: 2px solid #ff9800;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è showNotification</h1>
            <p>–ü–æ–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫—Ä–æ—Å–±—Ä–∞—É–∑–µ—Ä–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ push-—Å–ø–æ–≤—ñ—â–µ–Ω—å –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º–∏ –∑–≤—É–∫–∞–º–∏</p>
        </div>
        
        <div class="grid">
            <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ -->
            <div class="section">
                <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h3>
                <div id="permissionStatus" class="permission-status">
                    –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...
                </div>
                <div class="status-grid">
                    <div class="status-item" id="notificationSupport">
                        <strong>üîî Notification API:</strong><br>
                        <span id="supportStatus">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span>
                    </div>
                    <div class="status-item" id="audioSupport">
                        <strong>üéµ Audio API:</strong><br>
                        <span id="audioStatus">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span>
                    </div>
                    <div class="status-item" id="vibrationSupport">
                        <strong>üì≥ Vibration API:</strong><br>
                        <span id="vibrationStatus">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span>
                    </div>
                    <div class="status-item" id="browserInfo">
                        <strong>üåê –ë—Ä–∞—É–∑–µ—Ä:</strong><br>
                        <span id="browserStatus">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span>
                    </div>
                </div>
                <button onclick="requestPermission()" class="btn-info">
                    üîë –ó–∞–ø–∏—Ç–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                </button>
            </div>
            
            <!-- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ -->
            <div class="section">
                <h3>üéØ –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ</h3>
                <div class="feature-list">
                    <ul>
                        <li>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Notification API</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É</li>
                        <li>–ö–∞—Å—Ç–æ–º–Ω–∏–π –∑–≤—É–∫ –∑ <code>/notification.wav</code></li>
                        <li>–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑–≤—É–∫—É (graceful fallback)</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫</li>
                        <li>onClick —Ñ–æ–∫—É—Å—É–≤–∞–Ω–Ω—è –≤–∫–ª–∞–¥–∫–∏</li>
                        <li>–ì—É—á–Ω—ñ—Å—Ç—å –∞—É–¥—ñ–æ 60%</li>
                        <li>–í—ñ–±—Ä–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö [100,50,100]</li>
                        <li>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ lang, badge, tag, icon</li>
                        <li>Fallback —á–µ—Ä–µ–∑ alert + console.warn</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <!-- –ë–∞–∑–æ–≤—ñ —Ç–µ—Å—Ç–∏ -->
            <div class="section">
                <h3>üß™ –ë–∞–∑–æ–≤—ñ —Ç–µ—Å—Ç–∏</h3>
                <div class="button-grid">
                    <button onclick="testBasic()" class="btn-success">
                        üîî –ë–∞–∑–æ–≤–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                    </button>
                    <button onclick="testWithSound()" class="btn-info">
                        üéµ –ó –∑–≤—É–∫–æ–º —ñ –≤—ñ–±—Ä–∞—Ü—ñ—î—é
                    </button>
                    <button onclick="testSilent()" class="btn-warning">
                        üîá –ë–µ–∑–∑–≤—É—á–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                    </button>
                    <button onclick="testQuickClose()" class="btn-cyan">
                        ‚è∞ –®–≤–∏–¥–∫–µ –∑–∞–∫—Ä–∏—Ç—Ç—è (2—Å)
                    </button>
                </div>
            </div>
            
            <!-- –†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ç–µ—Å—Ç–∏ -->
            <div class="section">
                <h3>üöÄ –†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ç–µ—Å—Ç–∏</h3>
                <div class="button-grid">
                    <button onclick="testInteractive()" class="btn-purple">
                        üéØ –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ (onClick)
                    </button>
                    <button onclick="testWithFallback()" class="btn-danger">
                        üö® –ó fallback (alert)
                    </button>
                    <button onclick="testCustomization()" class="btn-info">
                        üé® –ü–æ–≤–Ω–∞ –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—è
                    </button>
                    <button onclick="testQuickNotifications()" class="btn-success">
                        ‚ö° –®–≤–∏–¥–∫—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                    </button>
                </div>
            </div>
            
            <!-- Realtime —Ç–µ—Å—Ç–∏ -->
            <div class="section">
                <h3>üì° Realtime —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h3>
                <div class="button-grid">
                    <button onclick="simulateNewScenario()" class="btn-info">
                        üÜï –ù–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π
                    </button>
                    <button onclick="simulateAgreedStatus()" class="btn-success">
                        ü§ù –°—Ç–∞—Ç—É—Å: –ü–æ–≥–æ–¥–∂–µ–Ω–æ
                    </button>
                    <button onclick="simulateCompletedStatus()" class="btn-success">
                        ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                    </button>
                    <button onclick="simulateErrorStatus()" class="btn-danger">
                        ‚ùå –°—Ç–∞—Ç—É—Å: –ü–æ–º–∏–ª–∫–∞
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –õ–æ–≥–∏ -->
        <div class="section">
            <h3>üìã –õ–æ–≥ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h3>
            <button onclick="clearLog()" class="btn-warning" style="margin-bottom: 15px;">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥
            </button>
            <div id="log" class="log">
                <div class="log-entry">
                    <strong>[INIT]</strong> –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // === –Ü–º–ø–æ—Ä—Ç —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó (—Å–∏–º—É–ª—è—Ü—ñ—è) ===
        
        // –¢–∏–ø–∏ (–∫–æ–ø—ñ—è –∑ TypeScript —Ñ–∞–π–ª—É)
        const NotificationSupport = {
            isSupported: 'Notification' in window,
            permission: 'Notification' in window ? Notification.permission : 'denied',
            audioSupported: 'Audio' in window,
            vibrationSupported: 'vibrate' in navigator,
            userAgent: navigator.userAgent
        };

        // –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—É–∫—É
        const playNotificationSound = async (soundUrl = '/notification.wav', volume = 0.6) => {
            try {
                const audio = new Audio(soundUrl);
                audio.volume = Math.max(0, Math.min(1, volume));
                audio.preload = 'auto';

                return new Promise((resolve) => {
                    audio.oncanplaythrough = async () => {
                        try {
                            await audio.play();
                            log(`üéµ –ó–≤—É–∫ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–æ: ${soundUrl}`, 'success');
                            resolve(true);
                        } catch (playError) {
                            log(`üîá –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—É–∫—É: ${playError.message}`, 'warning');
                            resolve(false);
                        }
                    };

                    audio.onerror = (error) => {
                        log(`üîá –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–≤—É–∫—É ${soundUrl}`, 'error');
                        resolve(false);
                    };

                    setTimeout(() => {
                        log('üîá Timeout –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–≤—É–∫—É', 'warning');
                        resolve(false);
                    }, 3000);
                });
            } catch (error) {
                log(`üîá –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –∞—É–¥—ñ–æ: ${error.message}`, 'error');
                return false;
            }
        };

        // –§—É–Ω–∫—Ü—ñ—è –≤—ñ–±—Ä–∞—Ü—ñ—ó
        const triggerVibration = (pattern = [100, 50, 100]) => {
            try {
                if ('vibrate' in navigator) {
                    navigator.vibrate(pattern);
                    log(`üì≥ –í—ñ–±—Ä–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞: [${pattern.join(',')}]`, 'success');
                    return true;
                }
                return false;
            } catch (error) {
                log(`üì≥ –ü–æ–º–∏–ª–∫–∞ –≤—ñ–±—Ä–∞—Ü—ñ—ó: ${error.message}`, 'warning');
                return false;
            }
        };

        // –ó–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É
        const requestNotificationPermission = async () => {
            if (!NotificationSupport.isSupported) {
                log('üö´ Notification API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return 'denied';
            }

            if (Notification.permission === 'granted') {
                return 'granted';
            }

            try {
                const permission = await Notification.requestPermission();
                log(`üîë –î–æ–∑–≤—ñ–ª –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: ${permission}`, permission === 'granted' ? 'success' : 'warning');
                updatePermissionStatus();
                return permission;
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É –¥–æ–∑–≤–æ–ª—É: ${error.message}`, 'error');
                return 'denied';
            }
        };

        // –£–ù–Ü–í–ï–†–°–ê–õ–¨–ù–ê –§–£–ù–ö–¶–Ü–Ø showNotification
        const showNotification = async (title, options = {}) => {
            log(`üîî –°–ø—Ä–æ–±–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: "${title}"`, 'info');

            // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
            if (!NotificationSupport.isSupported) {
                log('üö´ –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î Notification API', 'error');
                if (options.fallbackAlert) {
                    alert(`${title}\n${options.body || ''}`);
                }
                log(`üì¢ Fallback: ${title} - ${options.body || ''}`, 'warning');
                return false;
            }

            // 2. –ó–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É
            const permission = await requestNotificationPermission();
            if (permission !== 'granted') {
                log('üö´ –î–æ–∑–≤—ñ–ª –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–µ –Ω–∞–¥–∞–Ω–∏–π', 'error');
                if (options.fallbackAlert) {
                    alert(`${title}\n${options.body || ''}`);
                }
                log(`üì¢ Fallback: ${title} - ${options.body || ''}`, 'warning');
                return false;
            }

            try {
                // 3. –ó–≤—É–∫
                if (options.sound !== false && NotificationSupport.audioSupported) {
                    const soundUrl = options.soundUrl || '/notification.wav';
                    const volume = options.volume || 0.6;
                    playNotificationSound(soundUrl, volume).catch(error => {
                        log(`üîá –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤—É–∫: ${error}`, 'warning');
                    });
                }

                // 8. –í—ñ–±—Ä–∞—Ü—ñ—è
                if (options.vibrate !== false && NotificationSupport.vibrationSupported) {
                    const vibratePattern = Array.isArray(options.vibrate) ? options.vibrate : [100, 50, 100];
                    triggerVibration(vibratePattern);
                }

                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                const notificationData = {
                    body: options.body || '',
                    icon: options.icon || '/favicon.ico',
                    badge: options.badge || '/favicon.ico',
                    tag: options.tag || `notification-${Date.now()}`,
                    lang: options.lang || 'uk',
                    requireInteraction: options.requireInteraction || false,
                    silent: options.silent || false,
                    dir: options.dir || 'auto',
                    renotify: options.renotify || false,
                    timestamp: options.timestamp || Date.now(),
                    data: options.data || {}
                };

                const notification = new Notification(title, notificationData);

                // 6. onClick –æ–±—Ä–æ–±–Ω–∏–∫
                notification.onclick = (event) => {
                    event.preventDefault();
                    
                    if (window.focus) window.focus();
                    if (window.parent && window.parent.focus) window.parent.focus();
                    
                    if (options.onClick && typeof options.onClick === 'function') {
                        try {
                            options.onClick();
                            log('‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–∏–π onClick –æ–±—Ä–æ–±–Ω–∏–∫', 'success');
                        } catch (error) {
                            log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ onClick: ${error.message}`, 'error');
                        }
                    }
                    
                    notification.close();
                };

                notification.onerror = (error) => {
                    log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–æ–∫–∞–∑—É —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: ${error}`, 'error');
                };

                notification.onshow = () => {
                    log(`‚úÖ –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø–æ–∫–∞–∑–∞–Ω–æ: "${title}"`, 'success');
                };

                notification.onclose = () => {
                    log(`üîí –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ: "${title}"`, 'info');
                };

                // 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è
                const autoCloseTimeout = options.timeout || 5000;
                
                setTimeout(() => {
                    try {
                        notification.close();
                        log(`‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–∫—Ä–∏—Ç–æ —á–µ—Ä–µ–∑ ${autoCloseTimeout}–º—Å`, 'info');
                    } catch (error) {
                        log(`‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ–∑–∞–∫—Ä–∏—Ç—Ç—è: ${error.message}`, 'warning');
                    }
                }, autoCloseTimeout);

                return true;

            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
                
                if (options.fallbackAlert) {
                    alert(`${title}\n${options.body || ''}`);
                }
                
                log(`üì¢ Fallback: ${title} - ${options.body || ''}`, 'warning');
                return false;
            }
        };

        // === –§—É–Ω–∫—Ü—ñ—ó –ª–æ–≥—É–≤–∞–Ω–Ω—è ===
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            const logElement = document.getElementById('log');
            logElement.innerHTML = '<div class="log-entry"><strong>[CLEAR]</strong> –õ–æ–≥ –æ—á–∏—â–µ–Ω–æ...</div>';
        }

        // === –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É ===
        function updatePermissionStatus() {
            const permissionElement = document.getElementById('permissionStatus');
            const permission = NotificationSupport.isSupported ? Notification.permission : 'denied';
            
            permissionElement.className = `permission-status permission-${permission}`;
            
            switch(permission) {
                case 'granted':
                    permissionElement.innerHTML = '‚úÖ –î–æ–∑–≤—ñ–ª –Ω–∞–¥–∞–Ω–æ - —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å!';
                    break;
                case 'denied':
                    permissionElement.innerHTML = 'üö´ –î–æ–∑–≤—ñ–ª –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ - fallback —á–µ—Ä–µ–∑ alert';
                    break;
                default:
                    permissionElement.innerHTML = '‚ö†Ô∏è –î–æ–∑–≤—ñ–ª –Ω–µ –∑–∞–ø–∏—Ç–∞–Ω–æ - –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ';
            }
        }

        function updateSystemStatus() {
            // Notification API
            const supportElement = document.getElementById('supportStatus');
            const notificationSupportElement = document.getElementById('notificationSupport');
            if (NotificationSupport.isSupported) {
                supportElement.textContent = '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚úÖ';
                notificationSupportElement.className = 'status-item';
            } else {
                supportElement.textContent = '–ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚ùå';
                notificationSupportElement.className = 'status-item error';
            }

            // Audio API
            const audioElement = document.getElementById('audioStatus');
            const audioSupportElement = document.getElementById('audioSupport');
            if (NotificationSupport.audioSupported) {
                audioElement.textContent = '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚úÖ';
                audioSupportElement.className = 'status-item';
            } else {
                audioElement.textContent = '–ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚ùå';
                audioSupportElement.className = 'status-item error';
            }

            // Vibration API
            const vibrationElement = document.getElementById('vibrationStatus');
            const vibrationSupportElement = document.getElementById('vibrationSupport');
            if (NotificationSupport.vibrationSupported) {
                vibrationElement.textContent = '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚úÖ';
                vibrationSupportElement.className = 'status-item';
            } else {
                vibrationElement.textContent = '–ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚ùå';
                vibrationSupportElement.className = 'status-item warning';
            }

            // Browser info
            const browserElement = document.getElementById('browserStatus');
            const browserName = navigator.userAgent.split(' ').pop().split('/')[0];
            browserElement.textContent = `${browserName} ${navigator.userAgent.includes('Mobile') ? 'üì±' : 'üíª'}`;
        }

        // === –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è ===
        window.requestPermission = requestNotificationPermission;

        window.testBasic = () => {
            showNotification('üîî –ë–∞–∑–æ–≤–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', {
                body: '–ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å'
            });
        };

        window.testWithSound = () => {
            showNotification('üéµ –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑—ñ –∑–≤—É–∫–æ–º', {
                body: '–¢–µ—Å—Ç –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º –∑–≤—É–∫–æ–º —Ç–∞ –≤—ñ–±—Ä–∞—Ü—ñ—î—é',
                sound: true,
                vibrate: [200, 100, 200, 100, 200]
            });
        };

        window.testSilent = () => {
            showNotification('üîá –ë–µ–∑–∑–≤—É—á–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', {
                body: '–ë–µ–∑ –∑–≤—É–∫—É —Ç–∞ –≤—ñ–±—Ä–∞—Ü—ñ—ó',
                sound: false,
                vibrate: false,
                silent: true
            });
        };

        window.testQuickClose = () => {
            showNotification('‚è∞ –®–≤–∏–¥–∫–µ –∑–∞–∫—Ä–∏—Ç—Ç—è', {
                body: '–¶–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞–∫—Ä–∏—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏',
                timeout: 2000
            });
        };

        window.testInteractive = () => {
            showNotification('üéØ –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', {
                body: '–ö–ª—ñ–∫–Ω—ñ—Ç—å –¥–ª—è –≤–∏–∫–ª–∏–∫—É –∫–∞—Å—Ç–æ–º–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó',
                requireInteraction: true,
                onClick: () => {
                    log('üéâ –ö–ª—ñ–∫ –ø–æ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º—É —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—é!', 'success');
                    alert('–ö–∞—Å—Ç–æ–º–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –≤–∏–∫–ª–∏–∫–∞–Ω–æ!');
                }
            });
        };

        window.testWithFallback = () => {
            showNotification('üö® –ó fallback', {
                body: '–¶–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –º–∞—î fallback —á–µ—Ä–µ–∑ alert',
                fallbackAlert: true,
                onClick: () => log('Fallback —Ç–µ—Å—Ç –≤–∏–∫–æ–Ω–∞–Ω–æ', 'info')
            });
        };

        window.testCustomization = () => {
            showNotification('üé® –ü–æ–≤–Ω–∞ –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—è', {
                body: '–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑ —É—Å—ñ–º–∞ –º–æ–∂–ª–∏–≤–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏',
                icon: '/favicon.ico',
                badge: '/favicon.ico',
                tag: 'custom-test',
                lang: 'uk',
                sound: true,
                volume: 0.8,
                vibrate: [300, 100, 300, 100, 300],
                requireInteraction: true,
                timeout: 8000,
                onClick: () => {
                    log('üé® –ö–∞—Å—Ç–æ–º–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª–µ–Ω–æ!', 'success');
                }
            });
        };

        window.testQuickNotifications = async () => {
            await showNotification('‚úÖ –£—Å–ø—ñ—Ö', {
                body: '–û–ø–µ—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!',
                sound: true,
                timeout: 3000
            });

            setTimeout(async () => {
                await showNotification('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è', {
                    body: '–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é',
                    sound: true,
                    vibrate: [150, 100, 150],
                    timeout: 3000
                });
            }, 1000);

            setTimeout(async () => {
                await showNotification('‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è', {
                    body: '–ö–æ—Ä–∏—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞',
                    sound: false,
                    timeout: 3000
                });
            }, 2000);
        };

        // === Realtime —Å–∏–º—É–ª—è—Ü—ñ—ó ===
        window.simulateNewScenario = () => {
            showNotification('üÜï –ù–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –¥–æ—Å—Ç—É–ø–Ω–∏–π!', {
                body: '"–î–æ–ø–æ–º–æ–≥–∞ –∑ –ø–µ—Ä–µ—ó–∑–¥–æ–º —É –ö–∏—ó–≤—ñ" ‚Ä¢ –°—É–º–∞: 120 USDT ‚Ä¢ –¢–µ—Ä–º—ñ–Ω: 2 –¥–Ω—ñ',
                sound: true,
                timeout: 6000,
                onClick: () => {
                    log('üéØ –ö–ª—ñ–∫ –ø–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—é –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é', 'info');
                    alert('–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —Å–ø–∏—Å–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤');
                }
            });
        };

        window.simulateAgreedStatus = () => {
            showNotification('ü§ù –£–≥–æ–¥—É –ø–æ–≥–æ–¥–∂–µ–Ω–æ!', {
                body: '–°—Ü–µ–Ω–∞—Ä—ñ–π "–î–æ–ø–æ–º–æ–≥–∞ –∑ –ø–æ–∫—É–ø–∫–∞–º–∏" –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –æ–±–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏. –°—É–º–∞: 50 USDT',
                sound: true,
                vibrate: [200, 100, 200],
                timeout: 7000,
                onClick: () => {
                    log('ü§ù –ö–ª—ñ–∫ –ø–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—é —É–≥–æ–¥–∏', 'success');
                    alert('–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –¥–µ—Ç–∞–ª–µ–π —É–≥–æ–¥–∏');
                }
            });
        };

        window.simulateCompletedStatus = () => {
            showNotification('üéâ –°—Ü–µ–Ω–∞—Ä—ñ–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', {
                body: '–ö–æ—à—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ —á–µ—Ä–µ–∑ escrow. –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ 45 USDT (90% –≤—ñ–¥ —Å—É–º–∏ —É–≥–æ–¥–∏).',
                sound: true,
                vibrate: [300, 100, 300],
                requireInteraction: true,
                timeout: 8000,
                onClick: () => {
                    log('üéâ –ö–ª—ñ–∫ –ø–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è', 'success');
                    alert('–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π');
                }
            });
        };

        window.simulateErrorStatus = () => {
            showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó', {
                body: '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è MetaMask.',
                sound: true,
                vibrate: [500, 200, 500],
                fallbackAlert: true,
                timeout: 8000,
                onClick: () => {
                    log('‚ùå –ö–ª—ñ–∫ –ø–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—é –ø–æ–º–∏–ª–∫–∏', 'error');
                    alert('–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –¥–æ–≤—ñ–¥–∫–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MetaMask');
                }
            });
        };

        // === –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ===
        document.addEventListener('DOMContentLoaded', () => {
            updateSystemStatus();
            updatePermissionStatus();
            log('üöÄ –°–∏—Å—Ç–µ–º–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Ç–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è!', 'success');
        });
    </script>
</body>
</html>
