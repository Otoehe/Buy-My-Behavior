<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì° Demo: Realtime Push Notifications –¥–ª—è BMB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status-card h3 {
            color: #ffd700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-connected { background: #4CAF50; }
        .status-disconnected { background: #f44336; }
        .status-polling { background: #ff9800; }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn-new { background: linear-gradient(45deg, #2196F3, #1976D2); }
        .btn-agreed { background: linear-gradient(45deg, #4CAF50, #388e3c); }
        .btn-completed { background: linear-gradient(45deg, #ff9800, #f57c00); }
        .btn-error { background: linear-gradient(45deg, #f44336, #d32f2f); }
        .btn-test { background: linear-gradient(45deg, #9c27b0, #7b1fa2); }
        .btn-control { background: linear-gradient(45deg, #607d8b, #455a64); }
        
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px 10px;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        
        .log-entry.info { border-left-color: #2196F3; background: rgba(33, 150, 243, 0.1); }
        .log-entry.success { border-left-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
        .log-entry.warning { border-left-color: #ff9800; background: rgba(255, 152, 0, 0.1); }
        .log-entry.error { border-left-color: #f44336; background: rgba(244, 67, 54, 0.1); }
        
        .scenario-flow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .flow-step {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .flow-step:hover {
            border-color: #ffd700;
            transform: scale(1.05);
        }
        
        .flow-step.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì° Realtime Push Notifications</h1>
            <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –¥–ª—è BuyMyBehavior</p>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å –ø–∞–Ω–µ–ª—å -->
        <div class="status-panel">
            <div class="status-card">
                <h3>
                    <span class="status-indicator" id="connectionIndicator"></span>
                    –°—Ç–∞—Ç—É—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                </h3>
                <p><strong>–ú–µ—Ç–æ–¥:</strong> <span id="connectionMethod">–í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è...</span></p>
                <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> <span id="currentUser">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π</span></p>
                <p><strong>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</strong> <span id="activityStatus">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...</span></p>
            </div>
            
            <div class="status-card">
                <h3>üîî –°—Ç–∞—Ç—É—Å —Å–ø–æ–≤—ñ—â–µ–Ω—å</h3>
                <p><strong>–î–æ–∑–≤—ñ–ª:</strong> <span id="notificationPermission">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span></p>
                <p><strong>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞:</strong> <span id="notificationSupport">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</span></p>
                <p><strong>–û—Å—Ç–∞–Ω–Ω—î:</strong> <span id="lastNotification">-</span></p>
            </div>
            
            <div class="status-card">
                <h3>üìä –ú–µ—Ç—Ä–∏–∫–∏</h3>
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="totalNotifications">0</div>
                        <div class="metric-label">–í—Å—å–æ–≥–æ</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="successfulNotifications">0</div>
                        <div class="metric-label">–£—Å–ø—ñ—à–Ω–∏—Ö</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ—Ç—ñ–∫ —Å—Ü–µ–Ω–∞—Ä—ñ—é -->
        <div class="demo-section">
            <h3>üé¨ –ü–æ—Ç—ñ–∫ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —Å—Ü–µ–Ω–∞—Ä—ñ—é</h3>
            <div class="scenario-flow">
                <div class="flow-step" id="step-created">
                    <h4>üÜï –°—Ç–≤–æ—Ä–µ–Ω–æ</h4>
                    <p>–ù–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π</p>
                </div>
                <div class="flow-step" id="step-agreed">
                    <h4>ü§ù –ü–æ–≥–æ–¥–∂–µ–Ω–æ</h4>
                    <p>–û–±–∏–¥–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏</p>
                </div>
                <div class="flow-step" id="step-confirmed">
                    <h4>‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</h4>
                    <p>–†–æ–∑–ø–æ—á–∞—Ç–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</p>
                </div>
                <div class="flow-step" id="step-completed">
                    <h4>üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</h4>
                    <p>–ö–æ—à—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ</p>
                </div>
            </div>
            
            <div class="demo-grid">
                <button onclick="simulateStep('created')" class="btn-new">
                    üÜï –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ü–µ–Ω–∞—Ä—ñ–π
                </button>
                <button onclick="simulateStep('agreed')" class="btn-agreed">
                    ü§ù –ü–æ–≥–æ–¥–∏—Ç–∏ —É–≥–æ–¥—É
                </button>
                <button onclick="simulateStep('confirmed')" class="btn-completed">
                    ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø–æ—á–∞—Ç–æ–∫
                </button>
                <button onclick="simulateStep('completed')" class="btn-completed">
                    üéâ –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Å—Ü–µ–Ω–∞—Ä—ñ–π
                </button>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ -->
        <div class="demo-section">
            <h3>üö® –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π</h3>
            <div class="demo-grid">
                <button onclick="simulateError('transaction')" class="btn-error">
                    ‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
                </button>
                <button onclick="simulateError('network')" class="btn-error">
                    üåê –ú–µ—Ä–µ–∂–µ–≤–∞ –ø–æ–º–∏–ª–∫–∞
                </button>
                <button onclick="simulateError('timeout')" class="btn-error">
                    ‚è∞ –¢–∞–π–º–∞—É—Ç
                </button>
                <button onclick="simulateError('dispute')" class="btn-error">
                    ‚öîÔ∏è –°–ø—ñ—Ä
                </button>
            </div>
        </div>
        
        <!-- –°–∏—Å—Ç–µ–º–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó -->
        <div class="demo-section">
            <h3>üîß –°–∏—Å—Ç–µ–º–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</h3>
            <div class="demo-grid">
                <button onclick="testBasicNotification()" class="btn-test">
                    üß™ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                </button>
                <button onclick="testRealtimeConnection()" class="btn-test">
                    üì° –¢–µ—Å—Ç Realtime –∑'—î–¥–Ω–∞–Ω–Ω—è
                </button>
                <button onclick="simulateConnectionLoss()" class="btn-control">
                    üì∂ –°–∏–º—É–ª—è—Ü—ñ—è –≤—Ç—Ä–∞—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è
                </button>
                <button onclick="restartConnection()" class="btn-control">
                    üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                </button>
            </div>
        </div>
        
        <!-- –õ–æ–≥ -->
        <div class="log-container">
            <div class="log-header">
                <h3>üìã –õ–æ–≥ –ø–æ–¥—ñ–π Realtime</h3>
                <button onclick="clearLog()" class="btn-control">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
            </div>
            <div id="realtimeLog" class="log">
                <div class="log-entry info">
                    <strong>[INIT]</strong> –°–∏—Å—Ç–µ–º–∞ Realtime Notifications –≥–æ—Ç–æ–≤–∞ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
                </div>
            </div>
        </div>
    </div>

    <script>
        // === –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ ===
        let totalNotifications = 0;
        let successfulNotifications = 0;
        let currentStep = 'created';
        let isConnected = false;
        let connectionMethod = 'none';
        
        // === –õ–æ–≥—É–≤–∞–Ω–Ω—è ===
        function logEvent(message, type = 'info') {
            const log = document.getElementById('realtimeLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            updateLastNotification(message);
        }
        
        function clearLog() {
            const log = document.getElementById('realtimeLog');
            log.innerHTML = '<div class="log-entry info"><strong>[CLEAR]</strong> –õ–æ–≥ –æ—á–∏—â–µ–Ω–æ...</div>';
        }
        
        // === –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫ ===
        function updateMetrics() {
            document.getElementById('totalNotifications').textContent = totalNotifications;
            document.getElementById('successfulNotifications').textContent = successfulNotifications;
        }
        
        function updateLastNotification(message) {
            document.getElementById('lastNotification').textContent = 
                message.length > 30 ? message.substring(0, 30) + '...' : message;
        }
        
        // === –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ===
        function updateConnectionStatus(connected, method = 'none') {
            isConnected = connected;
            connectionMethod = method;
            
            const indicator = document.getElementById('connectionIndicator');
            const methodElement = document.getElementById('connectionMethod');
            const activityElement = document.getElementById('activityStatus');
            
            if (connected) {
                indicator.className = `status-indicator ${method === 'polling' ? 'status-polling' : 'status-connected'}`;
                methodElement.textContent = method === 'polling' ? 'Polling (Fallback)' : 'Supabase Realtime';
                activityElement.textContent = '–ê–∫—Ç–∏–≤–Ω–∏–π';
                logEvent(`‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ ${method}`, 'success');
            } else {
                indicator.className = 'status-indicator status-disconnected';
                methodElement.textContent = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';
                activityElement.textContent = '–ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π';
                logEvent('‚ùå –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—Ç—Ä–∞—á–µ–Ω–æ', 'error');
            }
        }
        
        // === –°–∏–º—É–ª—è—Ü—ñ—è —Å–ø–æ–≤—ñ—â–µ–Ω—å ===
        async function showRealtimeNotification(title, options = {}) {
            totalNotifications++;
            
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ API –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    // –ó–≤—É–∫
                    if (options.sound !== false) {
                        try {
                            const audio = new Audio('/notification.wav');
                            audio.volume = 0.6;
                            audio.play().catch(() => {});
                        } catch (e) {}
                    }
                    
                    // –í—ñ–±—Ä–∞—Ü—ñ—è
                    if (options.vibrate && 'vibrate' in navigator) {
                        navigator.vibrate(options.vibrate);
                    }
                    
                    const notification = new Notification(title, {
                        body: options.body || '',
                        icon: '/favicon.ico',
                        requireInteraction: options.requireInteraction || false
                    });
                    
                    notification.onclick = () => {
                        if (options.onClick) options.onClick();
                        notification.close();
                    };
                    
                    setTimeout(() => notification.close(), options.timeout || 5000);
                    
                    successfulNotifications++;
                    logEvent(`üì® –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø–æ–∫–∞–∑–∞–Ω–æ: "${title}"`, 'success');
                } else {
                    logEvent(`üö´ –î–æ–∑–≤—ñ–ª –Ω–µ –Ω–∞–¥–∞–Ω–∏–π –¥–ª—è: "${title}"`, 'warning');
                }
            } else {
                logEvent(`üö´ Notification API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è: "${title}"`, 'error');
            }
            
            updateMetrics();
        }
        
        // === –°–∏–º—É–ª—è—Ü—ñ—è –∫—Ä–æ–∫—ñ–≤ —Å—Ü–µ–Ω–∞—Ä—ñ—é ===
        function simulateStep(step) {
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä
            document.querySelectorAll('.flow-step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            
            currentStep = step;
            
            switch(step) {
                case 'created':
                    showRealtimeNotification('üÜï –ù–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π —Å—Ç–≤–æ—Ä–µ–Ω–æ!', {
                        body: '"–î–æ–ø–æ–º–æ–≥–∞ –∑ –ø–µ—Ä–µ—ó–∑–¥–æ–º —É –ö–∏—î–≤—ñ" ‚Ä¢ –°—É–º–∞: 120 USDT ‚Ä¢ –¢–µ—Ä–º—ñ–Ω: 2 –¥–Ω—ñ',
                        sound: true,
                        timeout: 6000,
                        onClick: () => logEvent('üéØ –ö–ª—ñ–∫: –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é', 'info')
                    });
                    logEvent('üìù –°–∏–º—É–ª—è—Ü—ñ—è: —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π', 'info');
                    break;
                    
                case 'agreed':
                    showRealtimeNotification('ü§ù –£–≥–æ–¥—É –ø–æ–≥–æ–¥–∂–µ–Ω–æ!', {
                        body: '–°—Ü–µ–Ω–∞—Ä—ñ–π –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –æ–±–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏. –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.',
                        sound: true,
                        vibrate: [200, 100, 200],
                        timeout: 7000,
                        onClick: () => logEvent('üéØ –ö–ª—ñ–∫: –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –¥–µ—Ç–∞–ª–µ–π —É–≥–æ–¥–∏', 'info')
                    });
                    logEvent('ü§ù –°–∏–º—É–ª—è—Ü—ñ—è: —É–≥–æ–¥—É –ø–æ–≥–æ–¥–∂–µ–Ω–æ –æ–±–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏', 'success');
                    break;
                    
                case 'confirmed':
                    showRealtimeNotification('‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ—Ç—Ä–∏–º–∞–Ω–æ', {
                        body: '–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑–ø–æ—á–∞–≤ —Ä–æ–±–æ—Ç—É.',
                        sound: true,
                        timeout: 5000,
                        onClick: () => logEvent('üéØ –ö–ª—ñ–∫: –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è', 'info')
                    });
                    logEvent('‚úÖ –°–∏–º—É–ª—è—Ü—ñ—è: –æ—Ç—Ä–∏–º–∞–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏', 'success');
                    break;
                    
                case 'completed':
                    showRealtimeNotification('üéâ –°—Ü–µ–Ω–∞—Ä—ñ–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', {
                        body: '–ö–æ—à—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ —á–µ—Ä–µ–∑ escrow. –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ 108 USDT (90% –≤—ñ–¥ —Å—É–º–∏ —É–≥–æ–¥–∏).',
                        sound: true,
                        vibrate: [300, 100, 300],
                        requireInteraction: true,
                        timeout: 8000,
                        onClick: () => logEvent('üéØ –ö–ª—ñ–∫: –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π', 'success')
                    });
                    logEvent('üéâ –°–∏–º—É–ª—è—Ü—ñ—è: —Å—Ü–µ–Ω–∞—Ä—ñ–π —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –∫–æ—à—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ', 'success');
                    break;
            }
        }
        
        // === –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫ ===
        function simulateError(errorType) {
            let title, body, vibrate;
            
            switch(errorType) {
                case 'transaction':
                    title = '‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó';
                    body = '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –≤ –±–ª–æ–∫—á–µ–π–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è MetaMask.';
                    vibrate = [500, 200, 500];
                    break;
                case 'network':
                    title = 'üåê –ú–µ—Ä–µ–∂–µ–≤–∞ –ø–æ–º–∏–ª–∫–∞';
                    body = '–í—Ç—Ä–∞—á–µ–Ω–æ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ —Ä–µ–∂–∏–º offline.';
                    vibrate = [300, 100, 300, 100, 300];
                    break;
                case 'timeout':
                    title = '‚è∞ –¢–∞–π–º–∞—É—Ç –æ–ø–µ—Ä–∞—Ü—ñ—ó';
                    body = '–û–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
                    vibrate = [200, 100, 200];
                    break;
                case 'dispute':
                    title = '‚öîÔ∏è –í—ñ–¥–∫—Ä–∏—Ç–æ —Å–ø—ñ—Ä';
                    body = '–ü–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é –≤—ñ–¥–∫—Ä–∏—Ç–æ —Å–ø—ñ—Ä. –û—á—ñ–∫—É–π—Ç–µ —Ä–æ–∑–≥–ª—è–¥—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—î—é –ø—Ä–æ—Ç—è–≥–æ–º 24 –≥–æ–¥–∏–Ω.';
                    vibrate = [400, 200, 400];
                    break;
            }
            
            showRealtimeNotification(title, {
                body,
                sound: true,
                vibrate,
                timeout: 8000,
                onClick: () => logEvent(`üéØ –ö–ª—ñ–∫: –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–∫–∏ ${errorType}`, 'warning')
            });
            
            logEvent(`üö® –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ–º–∏–ª–∫–∏: ${errorType}`, 'error');
        }
        
        // === –¢–µ—Å—Ç–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó ===
        function testBasicNotification() {
            showRealtimeNotification('üß™ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', {
                body: '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ push-—Å–ø–æ–≤—ñ—â–µ–Ω—å',
                sound: true,
                timeout: 4000,
                onClick: () => logEvent('üéØ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–π–¥–µ–Ω–æ', 'success')
            });
            logEvent('üß™ –ó–∞–ø—É—â–µ–Ω–æ —Ç–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', 'info');
        }
        
        function testRealtimeConnection() {
            logEvent('üì° –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Realtime –∑\'—î–¥–Ω–∞–Ω–Ω—è...', 'info');
            
            // –°–∏–º—É–ª—é—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% —É—Å–ø—ñ—Ö—É
                if (success) {
                    updateConnectionStatus(true, 'realtime');
                    showRealtimeNotification('üì° Realtime –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', {
                        body: '–ó\'—î–¥–Ω–∞–Ω–Ω—è –∑ Supabase Realtime –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!',
                        sound: true,
                        timeout: 4000
                    });
                } else {
                    updateConnectionStatus(true, 'polling');
                    showRealtimeNotification('üì° Fallback –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', {
                        body: 'Realtime –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ polling —Ä–µ–∂–∏–º',
                        sound: true,
                        timeout: 5000
                    });
                }
            }, 1500);
        }
        
        function simulateConnectionLoss() {
            updateConnectionStatus(false);
            showRealtimeNotification('üì∂ –ó\'—î–¥–Ω–∞–Ω–Ω—è –≤—Ç—Ä–∞—á–µ–Ω–æ', {
                body: '–í—Ç—Ä–∞—á–µ–Ω–æ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –°–ø—Ä–æ–±–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è...',
                sound: true,
                vibrate: [200, 100, 200],
                timeout: 4000
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–±—É—î–º–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                logEvent('üîÑ –°–ø—Ä–æ–±–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑\'—î–¥–Ω–∞–Ω–Ω—è...', 'warning');
                setTimeout(() => {
                    updateConnectionStatus(true, 'polling');
                }, 2000);
            }, 3000);
        }
        
        function restartConnection() {
            logEvent('üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...', 'info');
            updateConnectionStatus(false);
            
            setTimeout(() => {
                updateConnectionStatus(true, Math.random() > 0.5 ? 'realtime' : 'polling');
                showRealtimeNotification('üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ', {
                    body: 'Realtime –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ',
                    sound: true,
                    timeout: 3000
                });
            }, 2000);
        }
        
        // === –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ===
        document.addEventListener('DOMContentLoaded', () => {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Å–ø–æ–≤—ñ—â–µ–Ω—å
            const support = 'Notification' in window;
            const permission = support ? Notification.permission : 'denied';
            
            document.getElementById('notificationSupport').textContent = support ? '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚úÖ' : '–ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è ‚ùå';
            document.getElementById('notificationPermission').textContent = permission === 'granted' ? '–ù–∞–¥–∞–Ω–æ ‚úÖ' : 
                                                                           permission === 'denied' ? '–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ ‚ùå' : '–ù–µ –∑–∞–ø–∏—Ç–∞–Ω–æ ‚ö†Ô∏è';
            
            // –°–∏–º—É–ª—é—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
            setTimeout(() => {
                testRealtimeConnection();
            }, 1000);
            
            // –°–∏–º—É–ª—é—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            document.getElementById('currentUser').textContent = 'demo-user-' + Math.random().toString(36).substr(2, 5);
            
            logEvent('üöÄ –°–∏—Å—Ç–µ–º–∞ Realtime Notifications —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞', 'success');
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫
        setInterval(updateMetrics, 1000);
    </script>
</body>
</html>
